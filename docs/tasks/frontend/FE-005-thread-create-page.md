# FE-005: スレッド作成ページ/フォームの実装

## 概要
新規スレッドを作成するためのページとフォームを実装する。タイトル、カテゴリ、タグ、初回投稿の入力機能を提供。

## 優先度
**High** - コア機能（これがないとスレッドが作れない）

## 難易度
**Medium**

## 前提条件
- [x] FE-001: プロジェクトセットアップが完了
- [x] FE-002: 共通コンポーネントが完成（特にフォーム関連）
- [x] バックエンドAPIが利用可能（`POST /api/v1/threads/`）

## 実装内容

### 1. ページコンポーネント (`src/pages/ThreadCreatePage.tsx`)
- [ ] ページレイアウトの実装
- [ ] パンくずリスト（トップ > スレッド作成）
- [ ] フォームコンポーネントの配置
- [ ] 認証チェック（必要に応じて）

### 2. スレッド作成フォーム (`src/components/forms/ThreadCreateForm.tsx`)
- [ ] React Hook Formのセットアップ
- [ ] Zodによるバリデーションスキーマ定義
- [ ] フォームフィールドの実装：
  - [ ] タイトル（必須、最大200文字）
  - [ ] カテゴリ選択（必須）
  - [ ] タグ選択（複数選択可、最大5個）
  - [ ] 初回投稿内容（必須、最大10000文字）
- [ ] フォーム送信処理
- [ ] エラーハンドリング
- [ ] 送信中のローディング状態

### 3. バリデーション
- [ ] タイトルのバリデーション
  - 必須チェック
  - 文字数制限（1-200文字）
  - 禁止文字チェック（必要に応じて）
- [ ] カテゴリのバリデーション
  - 必須チェック
  - 有効なカテゴリIDか確認
- [ ] タグのバリデーション
  - 最大5個まで
  - 有効なタグIDか確認
- [ ] 初回投稿のバリデーション
  - 必須チェック
  - 文字数制限（1-10000文字）
  - NGワードチェック（必要に応じて）

### 4. API連携
- [ ] カテゴリ一覧の取得（`GET /api/v1/categories/`）
- [ ] タグ一覧の取得（`GET /api/v1/tags/`）
- [ ] スレッド作成リクエスト（`POST /api/v1/threads/`）
- [ ] 楽観的UI更新（Optimistic Update）
- [ ] エラーレスポンスの処理
- [ ] 作成成功後のリダイレクト（スレッド詳細ページへ）

### 5. UI/UXの実装
- [ ] リアルタイムバリデーションフィードバック
- [ ] 文字数カウンター表示
- [ ] タグ選択のUI（チェックボックスまたはマルチセレクト）
- [ ] プレビュー機能（オプション）
- [ ] 下書き保存機能（オプション、LocalStorage利用）
- [ ] 確認ダイアログ（キャンセル時）

### 6. エラーハンドリング
- [ ] バリデーションエラーの表示（各フィールド下）
- [ ] APIエラーの表示（フォーム上部）
- [ ] ネットワークエラーの処理
- [ ] レート制限エラーの処理

### 7. レスポンシブ対応
- [ ] モバイルビュー
- [ ] タブレットビュー
- [ ] デスクトップビュー
- [ ] モバイルでの入力最適化（適切なinput type等）

### 8. テスト
- [ ] フォームコンポーネントのユニットテスト
- [ ] バリデーションのテスト
- [ ] API連携のテスト（モック使用）
- [ ] E2Eテスト（スレッド作成フロー全体）

## 受け入れ基準
- [ ] スレッドが正常に作成できる
- [ ] バリデーションが正しく動作する
- [ ] エラーが適切に表示される
- [ ] カテゴリとタグが選択できる
- [ ] 作成後、スレッド詳細ページに遷移する
- [ ] レスポンシブデザインが機能している
- [ ] アクセシビリティ基準を満たしている
- [ ] フォーム送信中は多重送信が防止される
- [ ] モバイルでも快適に入力できる

## バリデーションスキーマ例（Zod）
```typescript
import { z } from 'zod';

export const threadCreateSchema = z.object({
  title: z.string()
    .min(1, 'タイトルを入力してください')
    .max(200, 'タイトルは200文字以内で入力してください'),
  category: z.number({
    required_error: 'カテゴリを選択してください',
  }).int().positive(),
  tag_ids: z.array(z.number())
    .max(5, 'タグは最大5個まで選択できます')
    .optional(),
  initial_post_content: z.string()
    .min(1, '投稿内容を入力してください')
    .max(10000, '投稿内容は10000文字以内で入力してください'),
});

export type ThreadCreateInput = z.infer<typeof threadCreateSchema>;
```

## APIリクエスト例
```typescript
POST /api/v1/threads/
{
  "title": "スレッドのタイトル",
  "category": 1,
  "tag_ids": [1, 2, 3],
  "initial_post_content": "最初の投稿内容"
}
```

## UI/UX要件
- フォームは直感的で分かりやすく
- エラーメッセージは具体的で親切に
- 送信ボタンは押しやすく（モバイル対応）
- タグ選択は使いやすいUI（検索機能があると◎）
- 文字数制限が視覚的に分かる

## 関連タスク
- FE-002: コンポーネントライブラリ（フォームコンポーネント）
- FE-003: スレッド一覧ページ（作成後の遷移元）
- FE-004: スレッド詳細ページ（作成後の遷移先）
- BE-001: API統合テスト（スレッド作成API）

## 参考
- React Hook Form: https://react-hook-form.com/
- Zod: https://zod.dev/
- Form Validation Patterns: https://www.patterns.dev/react/form-validation
