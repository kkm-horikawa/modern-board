# FE-004: スレッド詳細・投稿一覧ページの実装

## 概要
個別スレッドの詳細情報と投稿一覧を表示するページを実装する。投稿作成、リアクション機能も含む。

## 優先度
**High** - コア機能

## 難易度
**Hard**

## 前提条件
- [x] FE-001: プロジェクトセットアップが完了
- [x] FE-002: 共通コンポーネントが完成
- [x] バックエンドAPIが利用可能

## 実装内容

### 1. ページコンポーネント (`src/pages/ThreadDetailPage.tsx`)
- [ ] スレッド詳細情報の取得と表示
- [ ] 投稿一覧の取得と表示
- [ ] ローディング状態の表示
- [ ] エラー状態の表示（404含む）
- [ ] スクロール位置の管理（特定投稿へのアンカーリンク対応）

### 2. スレッド詳細セクション
- [ ] スレッドタイトル
- [ ] カテゴリとタグの表示
- [ ] 作成日時、最終投稿日時
- [ ] 投稿数、閲覧数の表示
- [ ] ピン留め/ロックステータスの表示
- [ ] パンくずリスト（カテゴリ > スレッド）

### 3. 投稿一覧セクション
- [ ] 投稿番号付き表示（1, 2, 3...）
- [ ] 投稿者の一時名表示
- [ ] 投稿日時
- [ ] 投稿内容（Markdown対応検討）
- [ ] リアクションボタンと数（👍 いいね、😂 笑、😮 驚き等）
- [ ] 返信数の表示
- [ ] アンカーリンク（>>123 形式で投稿参照）

### 4. 投稿作成機能
- [ ] 投稿フォームの表示/非表示切り替え
- [ ] テキストエリア（内容入力）
- [ ] プレビュー機能（オプション）
- [ ] 投稿送信処理
- [ ] 楽観的UI更新（Optimistic Update）
- [ ] エラーハンドリング
- [ ] 投稿後のスクロール（新規投稿へ）

### 5. リアクション機能
- [ ] リアクションボタンのクリック処理
- [ ] リアクション数のリアルタイム更新
- [ ] 同一セッションからの重複リアクション制御
- [ ] アニメーション効果

### 6. アンカーリンク機能
- [ ] `>>123` 形式のリンク検出とクリック可能化
- [ ] クリック時の該当投稿へのスクロール
- [ ] ハイライト表示
- [ ] ホバー時のプレビュー表示（オプション）

### 7. ページネーション
- [ ] 投稿が多い場合のページネーション
- [ ] 「最新50件」「全件表示」の切り替え
- [ ] URLハッシュで特定投稿への直リンク対応

### 8. リアルタイム更新（オプション）
- [ ] WebSocketまたはポーリングで新規投稿を取得
- [ ] 「新しい投稿があります」通知
- [ ] 自動更新/手動更新の切り替え

### 9. レスポンシブ対応
- [ ] モバイルビュー
- [ ] タブレットビュー
- [ ] デスクトップビュー
- [ ] 投稿フォームのモバイル最適化

### 10. パフォーマンス最適化
- [ ] 仮想スクロール（投稿が多い場合）
- [ ] 画像の遅延読み込み
- [ ] コンポーネントのメモ化
- [ ] 差分更新の最適化

### 11. テスト
- [ ] ページコンポーネントのテスト
- [ ] 投稿作成機能のテスト
- [ ] リアクション機能のテスト
- [ ] アンカーリンクのテスト
- [ ] E2Eテスト

## 受け入れ基準
- [ ] スレッド詳細が正しく表示される
- [ ] 投稿一覧が正しく表示される
- [ ] 新規投稿が作成できる
- [ ] リアクションが正常に動作する
- [ ] アンカーリンクが機能する
- [ ] ページネーションが正常に動作する
- [ ] レスポンシブデザインが機能している
- [ ] パフォーマンスが良好
- [ ] アクセシビリティ基準を満たしている
- [ ] エラー状態が適切に処理される

## UI/UX要件
- 2ch/5ch風のシンプルなデザイン
- 投稿番号は明確に表示
- アンカーリンクは視覚的に分かりやすく
- リアクションボタンは直感的
- 投稿フォームは常にアクセス可能（固定または目立つ位置）
- モバイルでも快適に閲覧・投稿可能

## APIエンドポイント
- `GET /api/v1/threads/{id}/` - スレッド詳細取得
- `GET /api/v1/posts/?thread={id}` - 投稿一覧取得
- `POST /api/v1/posts/` - 投稿作成
- `POST /api/v1/posts/{id}/react/` - リアクション追加

## 技術的考慮事項
- Markdown対応の是非
- リアルタイム更新の実装方法（WebSocket vs Polling vs なし）
- 仮想スクロールの必要性（投稿数の上限次第）
- アンカーリンクのプレビュー実装

## 関連タスク
- FE-002: コンポーネントライブラリ
- FE-003: スレッド一覧ページ
- FE-005: スレッド作成フォーム
- BE-001: API統合テスト
- INT-001: リアルタイム更新機能（WebSocket）

## 参考
- Virtual Scrolling: https://tanstack.com/virtual/
- Optimistic Updates: https://tanstack.com/query/latest/docs/react/guides/optimistic-updates
- Markdown Editor: https://github.com/uiwjs/react-md-editor
